import{d as _e,p as be,u as we,a as ke,c as l,b as t,e as r,m as L,t as a,h as _,r as b,q as X,F as x,g as h,s as Z,T as ee,f as Ce,n as C,i as De,o,w as Me,v as ze,_ as $e}from"./index-DY03h_Ei.js";import{u as je}from"./useSmartRecipes-BlzbrvxC.js";import{h as Se,g as Pe}from"./useIngredientImage-BuW95jah.js";import"./user-BQF-L8bI.js";const Re={class:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 pb-24"},Te={class:"bg-white shadow-sm sticky top-0 z-20"},Fe={class:"px-4 py-4"},We={class:"flex items-center justify-between"},Ie={class:"text-sm text-gray-500"},Ae={class:"font-semibold text-purple-600"},Be={key:0,class:"px-4 py-4 space-y-4"},Le={class:"bg-white rounded-2xl shadow-md p-4"},Ne={class:"flex items-center justify-between mb-4"},Ve={class:"font-semibold text-gray-800"},qe={class:"grid grid-cols-7 gap-1"},Ee=["onClick"],Oe={class:"text-xs"},Ue={key:0,class:"w-5 h-5 mt-0.5"},Ye=["src"],Qe={key:1,class:"w-2 h-2 bg-purple-500 rounded-full mt-1"},Ge={class:"bg-white rounded-2xl shadow-md p-4"},He={class:"flex items-center justify-between mb-3"},Je={class:"font-semibold text-gray-800"},Ke={key:0,class:"text-xs text-gray-500"},Xe={key:0,class:"space-y-3"},Ze=["onClick"],et={class:"font-medium text-gray-800"},tt={class:"text-xs text-gray-500"},st={class:"flex items-center gap-1"},nt=["onClick"],lt=["onClick"],ot={key:1,class:"text-center py-6"},at={key:0,class:"fixed inset-x-0 bottom-0 z-30 bg-white rounded-t-3xl shadow-2xl max-h-[70vh] flex flex-col"},it={class:"p-4 border-b flex items-center justify-between flex-shrink-0"},rt={class:"font-semibold text-gray-800"},ut={class:"p-4 border-b flex-shrink-0"},dt={class:"flex-1 overflow-y-auto p-4 space-y-3"},ct=["onClick"],vt={class:"flex items-start justify-between"},pt={class:"font-medium text-gray-800"},gt={class:"text-xs text-gray-500"},xt={key:0,class:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full"},ht={key:0,class:"mt-2 text-xs text-orange-600"},ft={key:0},mt={key:2,class:"px-4 py-4"},yt={class:"flex items-center justify-between mb-6"},_t={key:0,class:"bg-white rounded-2xl shadow-md p-4 space-y-4"},bt={class:"flex items-center justify-between"},wt={class:"font-semibold text-gray-800"},kt={class:"grid grid-cols-7 gap-1"},Ct=["onClick"],Dt={class:"text-sm"},Mt={class:"text-sm text-purple-600"},zt={key:1,class:"space-y-4"},$t={class:"bg-white rounded-2xl shadow-md p-4"},jt={class:"text-sm text-gray-500"},St={class:"space-y-3 max-h-[50vh] overflow-y-auto"},Pt=["onClick"],Rt={class:"flex items-start justify-between"},Tt={class:"font-medium text-gray-800"},Ft={class:"text-xs text-gray-500"},Wt={key:0,class:"text-purple-500 text-xl"},It={key:0,class:"mt-2 text-xs text-orange-600"},At={key:1,class:"mt-2 text-xs text-green-600"},Bt={key:2,class:"space-y-4"},Lt={class:"flex gap-2 overflow-x-auto pb-2"},Nt=["onClick"],Vt={class:"text-xs text-gray-500"},qt={class:"text-xs text-purple-600 mt-1"},Et={class:"bg-purple-50 rounded-xl p-3"},Ot={class:"text-sm font-medium text-purple-800 mb-2"},Ut={key:0,class:"space-y-2"},Yt={class:"text-sm"},Qt=["onClick"],Gt={key:1,class:"text-sm text-purple-600"},Ht={class:"bg-white rounded-2xl shadow-md p-4"},Jt={class:"space-y-2"},Kt=["onClick"],Xt={key:0,class:"text-green-600 ml-2"},Zt={key:3,class:"space-y-4"},es={class:"space-y-3"},ts={class:"font-medium text-gray-800 mb-2"},ss={key:0,class:"space-y-1"},ns={key:1,class:"text-sm text-gray-400"},ls={class:"flex gap-3 mt-6"},os=_e({__name:"PlanView",setup(as){const te=De(),f=be(),S=we(),se=ke(),{scoredRecipes:N}=je(),M=b(!1),k=b(!1),P=b(""),R=b(new Date),T=n=>{const s=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0");return`${s}-${e}-${i}`},w=T(new Date),u=b(w),c=b(1),p=b(new Set),g=b(new Set),d=b({}),F=_(()=>R.value.getFullYear()),W=_(()=>R.value.getMonth()),V=_(()=>{const n=["ä¸€æœˆ","äºŒæœˆ","ä¸‰æœˆ","å››æœˆ","äº”æœˆ","å…­æœˆ","ä¸ƒæœˆ","å…«æœˆ","ä¹æœˆ","åæœˆ","åä¸€æœˆ","åäºŒæœˆ"];return`${F.value} å¹´ ${n[W.value]}`}),ne=_(()=>{const n=new Date,s=["é€±æ—¥","é€±ä¸€","é€±äºŒ","é€±ä¸‰","é€±å››","é€±äº”","é€±å…­"];return`${n.getMonth()+1}/${n.getDate()} ${s[n.getDay()]}`}),q=_(()=>{const n=F.value,s=W.value,i=new Date(n,s,1).getDay()||7,fe=new Date(n,s+1,0).getDate(),j=[],me=new Date(n,s,0).getDate();for(let v=i-1;v>0;v--){const D=me-v+1,y=new Date(n,s-1,D),B=T(y);j.push({date:B,day:D,isCurrentMonth:!1,isToday:!1,isPast:B<w,isFuture:B>w})}for(let v=1;v<=fe;v++){const D=new Date(n,s,v),y=T(D);j.push({date:y,day:v,isCurrentMonth:!0,isToday:y===w,isPast:y<w,isFuture:y>w})}const ye=42-j.length;for(let v=1;v<=ye;v++){const D=new Date(n,s+1,v),y=T(D);j.push({date:y,day:v,isCurrentMonth:!1,isToday:!1,isPast:y<w,isFuture:y>w})}return j});function I(n){return f.getMealsForDate(n).map(e=>S.recipes.find(i=>i.id===e)).filter(Boolean)}function E(n){const s=I(n);if(s.length===0)return null;const i=s[0].ingredient_ids[0];if(!i)return null;if(Se(i))return Pe(i);const m=S.getIngredientById(i);return(m==null?void 0:m.imageUrl)||null}function O(){R.value=new Date(F.value,W.value-1,1)}function U(){R.value=new Date(F.value,W.value+1,1)}function le(n){u.value=n,k.value=!1}const z=_(()=>I(u.value)),Y=_(()=>{const n=new Date(u.value),s=["é€±æ—¥","é€±ä¸€","é€±äºŒ","é€±ä¸‰","é€±å››","é€±äº”","é€±å…­"];return`${n.getMonth()+1}/${n.getDate()} ${s[n.getDay()]}`});function oe(n){f.removeMealFromDate(u.value,n)}function Q(n){te.push(`/recipe/${n}`)}function G(){k.value=!0,P.value=""}function H(){k.value=!1}const ae=_(()=>{const n=P.value.toLowerCase();let s=N.value;return n&&(s=s.filter(e=>e.recipe.title.toLowerCase().includes(n))),s.slice(0,20)});function ie(n){if(I(u.value).length>=3){alert("æ¯æ—¥æœ€å¤šå®‰æ’ 3 é“é£Ÿè­œ");return}if(!f.currentPlan){const e=f.createNewPlan([u.value]);f.savePlan(e)}f.addMealToDate(u.value,n),k.value=!1}function $(n){return n.ingredient_ids.filter(s=>!se.hasItem(s)).map(s=>{var e;return((e=S.getIngredientById(s))==null?void 0:e.name)||s})}function re(){M.value=!0,c.value=1,p.value=new Set,g.value=new Set,d.value={}}function J(){M.value=!1}function ue(n){p.value.has(n)?p.value.delete(n):p.value.add(n),p.value=new Set(p.value)}function de(n){g.value.has(n)?g.value.delete(n):g.value.add(n),g.value=new Set(g.value)}function ce(n,s){if(d.value[s]||(d.value[s]=[]),d.value[s].length>=3){alert("æ¯æ—¥æœ€å¤šå®‰æ’ 3 é“é£Ÿè­œ");return}d.value[s].includes(n)||d.value[s].push(n)}function ve(n,s){if(d.value[s]){const e=d.value[s].indexOf(n);e>=0&&d.value[s].splice(e,1)}}function A(n){return S.recipes.find(s=>s.id===n)}function pe(){if(c.value<4){if(c.value===1&&p.value.size===0){alert("è«‹é¸æ“‡è‡³å°‘ä¸€å€‹æ—¥æœŸ");return}if(c.value===2&&g.value.size===0){alert("è«‹é¸æ“‡è‡³å°‘ä¸€é“é£Ÿè­œ");return}c.value++}}function ge(){c.value>1&&c.value--}function xe(){const n=Array.from(p.value).sort();let s=f.currentPlan;s||(s=f.createNewPlan(n)),Object.entries(d.value).forEach(([e,i])=>{i.forEach(m=>{f.addMealToDate(e,m)})}),f.savePlan(s),J()}const K=_(()=>Array.from(p.value).sort()),he=_(()=>Array.from(g.value).map(n=>A(n)).filter(Boolean));return(n,s)=>(o(),l("div",Re,[t("header",Te,[t("div",Fe,[t("div",We,[s[2]||(s[2]=t("h1",{class:"text-xl font-bold text-gray-800"},"ğŸ“… é€±è¨ˆç•«",-1)),t("div",Ie,[s[1]||(s[1]=L(" ä»Šå¤© ",-1)),t("span",Ae,a(ne.value),1)])])])]),M.value?r("",!0):(o(),l("div",Be,[t("div",Le,[t("div",Ne,[t("button",{onClick:O,class:"p-2 hover:bg-gray-100 rounded-lg transition-colors"},"â†"),t("h2",Ve,a(V.value),1),t("button",{onClick:U,class:"p-2 hover:bg-gray-100 rounded-lg transition-colors"},"â†’")]),s[3]||(s[3]=t("div",{class:"grid grid-cols-7 gap-1 text-center text-xs text-gray-500 mb-2"},[t("div",null,"ä¸€"),t("div",null,"äºŒ"),t("div",null,"ä¸‰"),t("div",null,"å››"),t("div",null,"äº”"),t("div",{class:"text-orange-500"},"å…­"),t("div",{class:"text-orange-500"},"æ—¥")],-1)),t("div",qe,[(o(!0),l(x,null,h(q.value,e=>(o(),l("div",{key:e.date,onClick:i=>le(e.date),class:C(["aspect-square p-1 rounded-lg cursor-pointer transition-all flex flex-col items-center justify-center relative",{"bg-purple-500 text-white ring-2 ring-purple-600":u.value===e.date,"bg-purple-100 ring-2 ring-purple-400 font-bold":e.isToday&&u.value!==e.date,"hover:bg-gray-100":u.value!==e.date&&!e.isToday,"text-gray-300":!e.isCurrentMonth,"text-gray-400":e.isPast&&e.isCurrentMonth&&!e.isToday,"text-gray-800":e.isFuture&&e.isCurrentMonth,"text-purple-600 font-semibold":e.isToday&&e.isCurrentMonth}])},[t("span",Oe,a(e.day),1),E(e.date)?(o(),l("div",Ue,[t("img",{src:E(e.date),class:"w-full h-full object-contain rounded"},null,8,Ye)])):I(e.date).length>0?(o(),l("div",Qe)):r("",!0)],10,Ee))),128))])]),t("div",Ge,[t("div",He,[t("h3",Je," ğŸ“‹ "+a(Y.value)+" çš„è¨ˆç•« ",1),z.value.length>0?(o(),l("span",Ke,a(z.value.length)+"/3 é“ ",1)):r("",!0)]),z.value.length>0?(o(),l("div",Xe,[(o(!0),l(x,null,h(z.value,e=>(o(),l("div",{key:e.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-xl"},[t("div",{class:"flex-1 cursor-pointer",onClick:i=>Q(e.id)},[t("p",et,a(e.title),1),t("p",tt,a(e.min_month)+"-"+a(e.max_month)+"M",1)],8,Ze),t("div",st,[t("button",{onClick:i=>Q(e.id),class:"p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"æŸ¥çœ‹è©³æƒ…"}," ğŸ‘ï¸ ",8,nt),t("button",{onClick:i=>oe(e.id),class:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"åˆªé™¤"}," ğŸ—‘ï¸ ",8,lt)])]))),128)),z.value.length<3?(o(),l("button",{key:0,onClick:G,class:"w-full py-3 border-2 border-dashed border-purple-300 text-purple-600 rounded-xl hover:bg-purple-50 transition-colors flex items-center justify-center gap-2"},[...s[4]||(s[4]=[t("span",null,"â•",-1),t("span",null,"æ–°å¢é£Ÿè­œ",-1)])])):r("",!0)])):(o(),l("div",ot,[s[6]||(s[6]=t("p",{class:"text-gray-400 mb-4"},"ğŸ“­ å°šæœªå®‰æ’é£Ÿè­œ",-1)),t("button",{onClick:G,class:"px-6 py-3 bg-purple-500 text-white rounded-xl font-medium hover:bg-purple-600 transition-colors flex items-center justify-center gap-2 mx-auto"},[...s[5]||(s[5]=[t("span",null,"â•",-1),t("span",null,"æ–°å¢é£Ÿè­œ",-1)])])]))]),X(ee,{name:"slide-up"},{default:Z(()=>[k.value?(o(),l("div",at,[t("div",it,[t("div",null,[t("h3",rt,"æ–°å¢é£Ÿè­œåˆ° "+a(Y.value),1),s[7]||(s[7]=t("p",{class:"text-xs text-gray-500"},"é»æ“Šé¸æ“‡è¦åŠ å…¥çš„é£Ÿè­œ",-1))]),t("button",{onClick:H,class:"p-2 hover:bg-gray-100 rounded-full"},"âœ•")]),t("div",ut,[Me(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>P.value=e),type:"text",placeholder:"ğŸ” æœå°‹é£Ÿè­œ...",class:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[ze,P.value]])]),t("div",dt,[(o(!0),l(x,null,h(ae.value,e=>(o(),l("div",{key:e.recipe.id,onClick:i=>ie(e.recipe.id),class:"p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-purple-50 transition-colors"},[t("div",vt,[t("div",null,[t("h4",pt,a(e.recipe.title),1),t("p",gt,a(e.recipe.min_month)+"-"+a(e.recipe.max_month)+"M",1)]),e.readyToCook?(o(),l("span",xt," âœ… å¯åš ")):r("",!0)]),$(e.recipe).length>0?(o(),l("div",ht,[L(" ç¼º: "+a($(e.recipe).slice(0,3).join(", "))+" ",1),$(e.recipe).length>3?(o(),l("span",ft,"...ç­‰")):r("",!0)])):r("",!0)],8,ct))),128))])])):r("",!0)]),_:1}),X(ee,{name:"fade"},{default:Z(()=>[k.value?(o(),l("div",{key:0,onClick:H,class:"fixed inset-0 bg-black/30 z-20"})):r("",!0)]),_:1})])),!M.value&&!k.value?(o(),l("button",{key:1,onClick:re,class:"fixed bottom-24 right-4 z-10 px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 flex items-center gap-2 font-medium"},[...s[8]||(s[8]=[t("span",null,"âœ¨",-1),t("span",null,"æ™ºæ…§å¼•å°",-1)])])):r("",!0),M.value?(o(),l("div",mt,[t("div",{class:"flex items-center justify-between mb-4"},[s[9]||(s[9]=t("h2",{class:"text-lg font-bold text-gray-800"},"âœ¨ æ™ºæ…§å¼•å°",-1)),t("button",{onClick:J,class:"p-2 hover:bg-gray-100 rounded-full"},"âœ•")]),t("div",yt,[(o(),l(x,null,h(4,e=>t("div",{key:e,class:"flex items-center"},[t("div",{class:C(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",c.value>=e?"bg-purple-500 text-white":"bg-gray-200 text-gray-500"])},a(e),3),e<4?(o(),l("div",{key:0,class:C(["w-8 h-0.5 mx-1",c.value>e?"bg-purple-500":"bg-gray-200"])},null,2)):r("",!0)])),64))]),c.value===1?(o(),l("div",_t,[s[10]||(s[10]=t("div",null,[t("h3",{class:"font-semibold text-gray-800"},"ğŸ“† Step 1: é¸æ“‡æ—¥æœŸ"),t("p",{class:"text-sm text-gray-500"},"é»æ“Šé¸æ“‡è¦å®‰æ’çš„æ—¥æœŸï¼ˆå¯å¤šé¸ï¼‰")],-1)),t("div",bt,[t("button",{onClick:O,class:"p-2 hover:bg-gray-100 rounded-lg"},"â†"),t("h2",wt,a(V.value),1),t("button",{onClick:U,class:"p-2 hover:bg-gray-100 rounded-lg"},"â†’")]),s[11]||(s[11]=t("div",{class:"grid grid-cols-7 gap-1 text-center text-xs text-gray-500"},[t("div",null,"ä¸€"),t("div",null,"äºŒ"),t("div",null,"ä¸‰"),t("div",null,"å››"),t("div",null,"äº”"),t("div",{class:"text-orange-500"},"å…­"),t("div",{class:"text-orange-500"},"æ—¥")],-1)),t("div",kt,[(o(!0),l(x,null,h(q.value,e=>(o(),l("div",{key:e.date,onClick:i=>e.isCurrentMonth&&ue(e.date),class:C(["aspect-square p-1 rounded-lg cursor-pointer transition-all flex items-center justify-center",{"bg-orange-500 text-white":p.value.has(e.date),"hover:bg-gray-100":!p.value.has(e.date)&&e.isCurrentMonth,"text-gray-300 cursor-not-allowed":!e.isCurrentMonth}])},[t("span",Dt,a(e.day),1)],10,Ct))),128))]),t("p",Mt,"å·²é¸æ“‡ "+a(p.value.size)+" å€‹æ—¥æœŸ",1)])):r("",!0),c.value===2?(o(),l("div",zt,[t("div",$t,[s[12]||(s[12]=t("h3",{class:"font-semibold text-gray-800"},"ğŸ³ Step 2: é¸æ“‡é£Ÿè­œ",-1)),t("p",jt,"å·²é¸ "+a(g.value.size)+" é“",1)]),t("div",St,[(o(!0),l(x,null,h(Ce(N).slice(0,30),e=>(o(),l("div",{key:e.recipe.id,onClick:i=>de(e.recipe.id),class:C(["bg-white rounded-xl shadow-md p-4 cursor-pointer transition-all",g.value.has(e.recipe.id)?"ring-2 ring-purple-500 bg-purple-50":"hover:shadow-lg"])},[t("div",Rt,[t("div",null,[t("h4",Tt,a(e.recipe.title),1),t("p",Ft,a(e.recipe.min_month)+"-"+a(e.recipe.max_month)+"M",1)]),g.value.has(e.recipe.id)?(o(),l("span",Wt,"âœ“")):r("",!0)]),$(e.recipe).length>0?(o(),l("div",It," ç¼º: "+a($(e.recipe).slice(0,3).join(", ")),1)):(o(),l("div",At,"âœ… é£Ÿæé½Šå…¨"))],10,Pt))),128))])])):r("",!0),c.value===3?(o(),l("div",Bt,[s[14]||(s[14]=t("div",{class:"bg-white rounded-2xl shadow-md p-4"},[t("h3",{class:"font-semibold text-gray-800"},"ğŸ“… Step 3: åˆ†é…é£Ÿè­œ"),t("p",{class:"text-sm text-gray-500"},"é»æ“Šæ—¥æœŸï¼Œå†é»æ“Šé£Ÿè­œé€²è¡Œåˆ†é…")],-1)),t("div",Lt,[(o(!0),l(x,null,h(K.value,e=>(o(),l("div",{key:e,class:C(["flex-shrink-0 w-24 bg-white rounded-xl shadow-md p-3 text-center cursor-pointer",u.value===e?"ring-2 ring-purple-500":""]),onClick:i=>u.value=e},[t("p",Vt,a(e.slice(5)),1),t("p",qt,a((d.value[e]||[]).length)+" é“",1)],10,Nt))),128))]),t("div",Et,[t("p",Ot,a(u.value)+" å·²åˆ†é…ï¼š",1),(d.value[u.value]||[]).length>0?(o(),l("div",Ut,[(o(!0),l(x,null,h(d.value[u.value],e=>{var i;return o(),l("div",{key:e,class:"flex items-center justify-between bg-white rounded-lg p-2"},[t("span",Yt,a((i=A(e))==null?void 0:i.title),1),t("button",{onClick:m=>ve(e,u.value),class:"text-red-500 text-xs"},"âœ•",8,Qt)])}),128))])):(o(),l("p",Gt,"å°šæœªåˆ†é…"))]),t("div",Ht,[s[13]||(s[13]=t("p",{class:"text-sm font-medium text-gray-600 mb-3"},"é»æ“Šåˆ†é…ï¼š",-1)),t("div",Jt,[(o(!0),l(x,null,h(he.value,e=>(o(),l("button",{key:e.id,onClick:i=>ce(e.id,u.value),class:C(["w-full text-left p-3 rounded-xl transition-all",(d.value[u.value]||[]).includes(e.id)?"bg-green-100 text-green-800":"bg-gray-50 hover:bg-gray-100"])},[L(a(e.title)+" ",1),(d.value[u.value]||[]).includes(e.id)?(o(),l("span",Xt,"âœ“")):r("",!0)],10,Kt))),128))])])])):r("",!0),c.value===4?(o(),l("div",Zt,[s[16]||(s[16]=t("div",{class:"bg-white rounded-2xl shadow-md p-4"},[t("h3",{class:"font-semibold text-gray-800"},"âœ… Step 4: ç¢ºèªé è¦½")],-1)),t("div",es,[(o(!0),l(x,null,h(K.value,e=>(o(),l("div",{key:e,class:"bg-white rounded-xl shadow-md p-4"},[t("p",ts,"ğŸ“… "+a(e),1),(d.value[e]||[]).length>0?(o(),l("div",ss,[(o(!0),l(x,null,h(d.value[e],i=>{var m;return o(),l("div",{key:i,class:"text-sm text-gray-600 flex items-center gap-2"},[s[15]||(s[15]=t("span",null,"ğŸ³",-1)),t("span",null,a((m=A(i))==null?void 0:m.title),1)])}),128))])):(o(),l("p",ns,"æœªå®‰æ’"))]))),128))])])):r("",!0),t("div",ls,[c.value>1?(o(),l("button",{key:0,onClick:ge,class:"flex-1 py-3 bg-gray-200 text-gray-700 rounded-xl font-medium"},"â† ä¸Šä¸€æ­¥")):r("",!0),c.value<4?(o(),l("button",{key:1,onClick:pe,class:"flex-1 py-3 bg-purple-500 text-white rounded-xl font-medium"},"ä¸‹ä¸€æ­¥ â†’")):r("",!0),c.value===4?(o(),l("button",{key:2,onClick:xe,class:"flex-1 py-3 bg-green-500 text-white rounded-xl font-medium"},"âœ… å®Œæˆ")):r("",!0)])])):r("",!0)]))}}),cs=$e(os,[["__scopeId","data-v-cb8ddcec"]]);export{cs as default};
