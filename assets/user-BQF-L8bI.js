import{B as I,r as s,C as N,h as c}from"./index-DY03h_Ei.js";const f="babymeal-passport-user";function k(){try{const t=localStorage.getItem(f);if(t)return JSON.parse(t)}catch(t){console.error("Failed to load from localStorage:",t)}return null}function C(t){try{localStorage.setItem(f,JSON.stringify(t))}catch(u){console.error("Failed to save to localStorage:",u)}}const j=I("user",()=>{const t=k(),u=s((t==null?void 0:t.babyName)||""),i=s((t==null?void 0:t.birthday)||""),l=s((t==null?void 0:t.ingredientStates)||{}),a=s(new Set((t==null?void 0:t.favoriteRecipes)||[])),r=s((t==null?void 0:t.recipeRatings)||{}),g=c(()=>{if(!i.value)return 0;const e=new Date(i.value),n=new Date;let o=(n.getFullYear()-e.getFullYear())*12;return o+=n.getMonth()-e.getMonth(),n.getDate()<e.getDate()&&o--,Math.max(0,o)}),v=c(()=>{const e=g.value;if(e===0)return"尚未設定";if(e<12)return`${e} 個月`;const n=Math.floor(e/12),o=e%12;return o===0?`${n} 歲`:`${n} 歲 ${o} 個月`}),h=c(()=>Object.values(l.value).filter(e=>e.status==="tried").length),p=c(()=>Object.values(l.value).filter(e=>e.allergy).length),S=c(()=>Object.values(r.value).filter(e=>e==="like").length);function d(e,n){u.value=e,i.value=n}function y(e,n){const o=l.value[e]||{status:"not_tried",allergy:!1,preference:null,note:""};l.value[e]={...o,...n}}function b(e){return l.value[e]||{status:"not_tried",allergy:!1,preference:null,note:""}}function m(e){delete l.value[e]}function R(e){a.value.has(e)?a.value.delete(e):a.value.add(e),a.value=new Set(a.value)}function F(e){return a.value.has(e)}function M(e,n){n===null?delete r.value[e]:r.value[e]=n,r.value={...r.value}}function O(e){return r.value[e]||null}function w(e){return r.value[e]==="like"}return N([u,i,l,a,r],()=>{C({babyName:u.value,birthday:i.value,ingredientStates:l.value,favoriteRecipes:[...a.value],recipeRatings:r.value})},{deep:!0}),{babyName:u,birthday:i,ingredientStates:l,favoriteRecipes:a,recipeRatings:r,getAgeInMonths:g,getAgeDisplay:v,triedIngredientsCount:h,allergyIngredientsCount:p,likedRecipesCount:S,setBabyInfo:d,updateIngredientState:y,getIngredientState:b,resetIngredientState:m,toggleFavoriteRecipe:R,isFavoriteRecipe:F,setRecipeRating:M,getRecipeRating:O,isRecipeLiked:w}});export{j as u};
